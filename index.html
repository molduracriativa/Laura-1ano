<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>C√¢mera com Moldura em Tempo Real</title>

<style>
body,html{
    margin:0;
    width:100%;
    height:100%;
    background:#000;
    overflow:hidden;
    font-family:Arial,sans-serif;
}
.stage{
    position:relative;
    width:100%;
    height:100%;
    background:#000;
}
video,canvas,img{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    object-fit:cover;
}
#moldura{
    pointer-events:none;
    z-index:5;
}
#previewCanvas{
    z-index:2;
}
#startScreen{
    position:absolute;
    inset:0;
    background:url('capajpg.jpg') center/cover no-repeat;
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:10;
}
button{
    padding:14px 24px;
    font-size:18px;
    border:none;
    border-radius:30px;
}
.controls{
    position:absolute;
    bottom:20px;
    width:100%;
    display:flex;
    justify-content:center;
    gap:20px;
    z-index:6;
}
</style>
</head>

<body>

<div class="stage">
    <video id="camera" autoplay playsinline muted></video>
    <canvas id="previewCanvas"></canvas>
    <img id="moldura" src="moldura1.png">
</div>

<div id="startScreen">
    <button id="startBtn">Iniciar c√¢mera</button>
</div>

<div class="controls">
    <button id="photoBtn">üì∏ Foto</button>
    <button id="videoBtn">‚è∫ V√≠deo</button>
</div>

<script>
const video = document.getElementById('camera');
const canvas = document.getElementById('previewCanvas');
const ctx = canvas.getContext('2d');
const moldura = document.getElementById('moldura');

let stream, recorder, chunks=[], recording=false;
const DPR = window.devicePixelRatio || 1;

async function startCamera(){
    stream = await navigator.mediaDevices.getUserMedia({
        video:{ width:{ideal:1920}, height:{ideal:1080} },
        audio:true
    });
    video.srcObject = stream;
    video.play();
    document.getElementById('startScreen').style.display='none';
    resize();
    drawLoop();
}

function resize(){
    canvas.width = innerWidth * DPR;
    canvas.height = innerHeight * DPR;
    ctx.setTransform(DPR,0,0,DPR,0,0);
}

window.addEventListener('resize',resize);

function drawLoop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    const vw = video.videoWidth;
    const vh = video.videoHeight;
    if(vw){
        const r = vw/vh;
        let w = innerWidth;
        let h = w/r;
        if(h < innerHeight){
            h = innerHeight;
            w = h*r;
        }
        ctx.drawImage(video,(innerWidth-w)/2,(innerHeight-h)/2,w,h);
    }

    if(moldura.complete){
        ctx.drawImage(moldura,0,0,innerWidth,innerHeight);
    }

    requestAnimationFrame(drawLoop);
}

document.getElementById('photoBtn').onclick = ()=>{
    canvas.toBlob(b=>{
        const a=document.createElement('a');
        a.href=URL.createObjectURL(b);
        a.download='foto.png';
        a.click();
    },'image/png',1);
};

document.getElementById('videoBtn').onclick = ()=>{
    if(recording){
        recorder.stop();
        recording=false;
        return;
    }
    chunks=[];
    const streamCanvas = canvas.captureStream(30);
    stream.getAudioTracks().forEach(t=>streamCanvas.addTrack(t));

    recorder = new MediaRecorder(streamCanvas,{
        mimeType:'video/webm;codecs=vp9',
        videoBitsPerSecond:8000000
    });

    recorder.ondataavailable=e=>chunks.push(e.data);
    recorder.onstop=()=>{
        const blob=new Blob(chunks,{type:'video/webm'});
        const a=document.createElement('a');
        a.href=URL.createObjectURL(blob);
        a.download='video.webm';
        a.click();
    };
    recorder.start();
    recording=true;
};

document.getElementById('startBtn').onclick=startCamera;
</script>

</body>
</html>
